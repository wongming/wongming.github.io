<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Some birds aren't meant to be caged, that's all. Their feathers are just too bright."><title>【翻译】Simple-Smalltalk-Testing-With-Patterns(单元测试框架) | wongming</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【翻译】Simple-Smalltalk-Testing-With-Patterns(单元测试框架)</h1><a id="logo" href="/.">wongming</a><p class="description">wongming | byonecry | 凡高是我吗 的个人博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首頁</i></a><a href="/archives/"><i class="icon-archive"> 所有文章</i></a><a href="/about/"><i class="icon-about"> 關於</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">【翻译】Simple-Smalltalk-Testing-With-Patterns(单元测试框架)</h1><div class="post-meta">2015-11-19 | <span class="categories">分類於<a href="/categories/blog/"> blog</a></span></div><span data-thread-key="blog/Simple-Smalltalk-Testing-With-Patterns.html" class="ds-thread-count"></span><div class="post-content"><h2 id="Simple-Smalltalk-Testing-With-Patterns">Simple-Smalltalk-Testing-With-Patterns</h2><p>Kent Beck</p>
<p>First Class Software, Inc.<br><a id="more"></a><br>这个软件和文档是为编程社区提供服务的。First Class Software, Inc.并不提供任何保证，明示或默示。</p>
<h2 id="Introduction">Introduction</h2><p>Smalltalk因为缺少测试文化一直饱受困扰。本章通过描述一个简单的测试策略和框架来支持它。这个测试策略和框架并不是为一个完整的解决方案，但绝对是构建企业级工具和程序的起点。</p>
<p>这篇文章将分为三个部分：</p>
<ul>
<li>Philosophy - 描述编写和运行欠有框架的测试的基本思想理念。阅读这部分了解大致的背景。</li>
<li>Cookbook - 你编写测试的简单模式系统。</li>
<li>Framework - 一个简单易懂的测试框架的程序版本。深入阅读这部分来了解框架的机制。</li>
<li>Example - 一个用测试框架来测试方法的示例。</li>
</ul>
<h2 id="Philosophy">Philosophy</h2><p>我不太喜欢基于接口的测试。根据我的经验，基于用户接口脚本的测试健壮性很差而一点不易用。当我在做用用户接口测试的项目时，第二天早上测试报告中二三十个测试挂了是经常的事。然而快速检查后，大多数甚至所有的失败的测试实际上达到了程序的预期。一些接口的表面改变导致了实际上的输出不再和预期的输出匹配。我们的测试人员相比写测试脚本花了更多的时间来保证测试用例的迭代更新和追踪测试的正确性。</p>
<p>我的解决方案是在Smalltalk中编写测试和核对结果。尽管你的测试人员需要编写简单的Smalltalk程序,但是由此测试变得稳定的多了。</p>
<h3 id="Failures_and_Errors">Failures and Errors</h3><p>这个框架区分failures和errors。Failures是可预料的问题。当你编写测试时，你需要核实预期的结果。当你获得了一个不一样的结果，那就是一个failure。Error更加灾难性，你没有核对的错误状况。</p>
<h3 id="Unit_testing">Unit testing</h3><p>我建议开发者自己撰写他们自己的单元测试，每一个类一个。这个框架支持基于类编写测试套件。我建议所有的类都与testSuite挂钩，testSuite返回包括一系列的单元测试的suite。我建议开发者华25%-50%的时间开发测试。</p>
<h3 id="Integration_testing">Integration testing</h3><p>我建议一个独立的测试人员编写集成测试。那哪里该用集成测试呢？为了更好的编程式入口的用户接口框架的最近动向提供了一个答案- 用户接口，但是是在测试上做。In VisualWorks (the dialect used in the implementation below), you can open an ApplicationModel and begin stuffing values into its ValueHolders, causing all sorts of havoc, with very little trouble.</p>
<h3 id="Running_tests">Running tests</h3><p>最后一点关于理念原理的部分。先是设置好一系列数据，然后跑一系列的测试，最后清除，是很吸引人的。根据我的经验来看，它总是引发更多的问题但是它使值得的。测试停止和另外一个交互，一个测试的失败可以避免之后的测试继续运行。测试框架使得设置一系列的测试数据变得很容易，但是对于每个测试数据都会被创建和丢弃。这个方法下的潜在性能问题并不大，因为众多套件的测试可以不被观察地运行。</p>
<h2 id="Cookbook">Cookbook</h2><p>这里编写测试的简单模式系统。具体模式如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">Pattern</th>
<th style="text-align:left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Fixture</td>
<td style="text-align:left">Create a common test fixture.</td>
</tr>
<tr>
<td style="text-align:left">Test Case</td>
<td style="text-align:left">Create the stimulus for a test case.</td>
</tr>
<tr>
<td style="text-align:left">Check</td>
<td style="text-align:left">Check the response for a test case.</td>
</tr>
<tr>
<td style="text-align:left">Test Suite</td>
<td style="text-align:left">Aggregate TestCases.</td>
</tr>
</tbody>
</table>
<h3 id="Fixture">Fixture</h3><h4 id="怎么开始编写测试?">怎么开始编写测试?</h4><p>测试就是这些不可能任务的之一。你最好绝对完整的，这样你才可以肯定软件可以正常运行。否则，你的程序的可能状态数目会变得太大以至于你几乎不可能测试所有的组合。</p>
<p>如果你不了解你即将测试的东西，你永远不会开始。最好以以一个运行情况可以预估的单一配置开始。只有你对软件越来越来有经验，你才能够添加一系列的配置。</p>
<p>这样的配置称作fixture。一个fixture的举例如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">Fixture</th>
<th style="text-align:left">Predictions</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1.0 and 2.0</td>
<td style="text-align:left">Easy to predict answers to arithmetic problems.</td>
</tr>
<tr>
<td style="text-align:left">Network connection to a known machine</td>
<td style="text-align:left">Responses to network packets.</td>
</tr>
<tr>
<td style="text-align:left">#() and #(1 2 3)</td>
<td style="text-align:left">Results of sending testing messages.</td>
</tr>
</tbody>
</table>
<p>通过选择fixture你表述你即将测的和不测的。社区对象的完整系列的测试有很多fixture，每个都会被通过很多方式测试。</p>
<h4 id="设计一个test_fixture">设计一个test fixture</h4><ul>
<li>继承TestCase</li>
<li>为fixture中的每个已知对象添加实例变量</li>
<li>重写setup来初始化变量</li>
</ul>
<p>在示例中，test fixture有两组，一个空的，一个带有变量。首先，继承TestCase和添加我们后面需要引用的实例变量：</p>
<pre><code>Class: SetTestCase
    superclass: TestCase
   <span class="instruction"> instance </span>variables: empty full
</code></pre><p>然后，重写setUp来为fixture创建对象：</p>
<pre><code>SetTestCase&gt;&gt;setUp
    empty := Set new.
    full := Set
    with: <span class="hexcolor">#abc</span>
    with: <span class="number">5</span>
</code></pre><h3 id="Test_Case">Test Case</h3><p>你已经有了fixture，接下来该做什么？</p>
<h4 id="你如何表述一个单一的单元测试?">你如何表述一个单一的单元测试?</h4><p>你可以预测发送一个消息到fixture的结果。你需要以某种方式表述这样一个可预测的状况。</p>
<p>最简单的方法是交互式地表述。你可以在你的fixture中打开一个Inspector，然后给它发消息。这个方法有两个缺点。第一，你一直对同一个fixture发消息。一旦一个测试碰巧打乱了对象，所有的后续测试会失败，即使代码是正确的。更重要的是，因此，你不能很容易地使相互影响的测试和其他的交互。如果，你吧你的对象给其他测试，审查是唯一的方式。</p>
<p>通过吧每个可预测的状况表述为一个对象，每个都有自己的fixture，任何两个测试不会互相干扰。所以，我可以很容易把测试给其他人运行。</p>
<h4 id="把一个可预估的fixture的反应描述为一个方法">把一个可预估的fixture的反应描述为一个方法</h4><ul>
<li>给TestCase子类添加一个方法</li>
<li>在方法中驱动fixture</li>
</ul>
<p>示例代码会表明这些。我们可以预测把5加到一个空的组会导致5出现在组中。我们给我们的TestCase子类添加一个方法。在这个方法中我们驱动fixture。</p>
<pre><code><span class="constant">SetTestCase</span><span class="prompt">&gt;&gt;</span>testAdd
    empty <span class="symbol">add:</span> <span class="number">5</span>.
    ...
</code></pre><p>一旦你驱动了fixture，你需要添加一个check来保证你的预估是正确的。</p>
<h3 id="Check">Check</h3><p>一个Test Case驱动一个fixture。</p>
<h4 id="你如何测试预期的结果">你如何测试预期的结果</h4><p>如果你交互性地测试，你可以直接核对预期的结果。如果你需要查找一个以特定的返回值，你打印出来，保证你获得了正确的返回对象。如果你需要查找副作用，你可以使用Inspector。</p>
<p>由于测试在他们自己的对象中，你需要一个方法编程式的寻找问题。一个方法就是通过使用带有根据测试逻辑发送错误信号的标准错误处理机制(Object&gt;&gt;error:) 。</p>
<pre><code><span class="number">2</span> + <span class="number">3</span> = <span class="number">5</span> ifFalse: [self error: ‘Wrong answer’]
</code></pre><p>当你测试的时候，你需要区分你需要核查的错误，如，2+3得到了6，和你没有预测到的错误，如，下标超过范围或者消息你没有理解。</p>
<p>你对意料之外的错误所做的并不多（如果你对它做了，它不算是意料之外了，不是吗？）。当一个灾难性的错误发生，框架停止运行那个测试，记录下错误，然后继续运行下一个测试case。由于每个测试都有自己的fixture，上一个case的错误不会影响下一个case。</p>
<h2 id="未完待续。。。">未完待续。。。</h2><h2 id="结语">结语</h2><p>Translator:  wongming.cn</p>
<p>version:  v1</p>
<p>update:  2015年11月19日</p>
</div><div class="tags"><a href="/tags/测试/">测试</a><a href="/tags/翻译/">翻译</a></div><div class="post-nav"><a href="/blog/page-list-wrapper-for-front-end.html" class="pre"><i class="icon-previous">前端列表分页功能封装</i></a><a href="/blog/java-management.html" class="next">Java内存管理及对Java对象管理<i class="icon-next"></i></a></div><div data-thread-key="blog/Simple-Smalltalk-Testing-With-Patterns.html" data-title="【翻译】Simple-Smalltalk-Testing-With-Patterns(单元测试框架)" data-url="http://wongming.cn/blog/Simple-Smalltalk-Testing-With-Patterns.html" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="blog/Simple-Smalltalk-Testing-With-Patterns.html" data-title="【翻译】Simple-Smalltalk-Testing-With-Patterns(单元测试框架)" data-url="http://wongming.cn/blog/Simple-Smalltalk-Testing-With-Patterns.html" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://wongming.cn"/></form></div><div class="widget"><div class="widget-title">分類</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li></ul></div><div class="widget"><div class="widget-title">標籤</div><div class="tagcloud"><a href="/tags/列表分页/" style="font-size: 15px;">列表分页</a> <a href="/tags/Front-End/" style="font-size: 15px;">Front-End</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/内存管理/" style="font-size: 15px;">内存管理</a> <a href="/tags/测试/" style="font-size: 15px;">测试</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/page-list-wrapper-for-front-end.html">前端列表分页功能封装</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/Simple-Smalltalk-Testing-With-Patterns.html">【翻译】Simple-Smalltalk-Testing-With-Patterns(单元测试框架)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/java-management.html">Java内存管理及对Java对象管理</a></li></ul></div><div class="widget"><div class="comments-title">最近評論</div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title">友站連結</div><ul></ul><a href="https://www.zhihu.com/people/byonecry" title="知乎" target="_blank">知乎</a><ul></ul><a href="http://weibo.com/fangaoshiwo" title="微博" target="_blank">微博</a><ul></ul><a href="https://github.com/wongming" title="GitHub" target="_blank">GitHub</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">2015 Wongming.</a> Contact me by<a rel="nofollow" target="_blank" href="mailto:byonecry@qq.com"> Email</a> or<a rel="nofollow" target="_blank" href="http://weibo.com/fangaoshiwo"> Weibo</a> or<a rel="nofollow" target="_blank" href="https://github.com/wongming"> GitHub.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>var duoshuoQuery = {short_name:'wongming'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//dn-comment.qbox.me/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-71881751-1','auto');ga('send','pageview');
</script></div></body></html>